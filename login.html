<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
        <title>Login | Beleful Dashboard </title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- BEGIN GLOBAL MANDATORY STYLES -->
        <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/plugins.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/authentication/form-2.css" rel="stylesheet" type="text/css" />
        <!-- END GLOBAL MANDATORY STYLES -->
        <link rel="stylesheet" type="text/css" href="assets/css/forms/theme-checkbox-radio.css">
        <link rel="stylesheet" type="text/css" href="assets/css/forms/switches.css">
        <!--  BEGIN CUSTOM STYLE FILE  -->
        <link rel="stylesheet" type="text/css" href="assets/css/elements/alert.css">
        <link href="plugins/loaders/custom-loader.css" rel="stylesheet" type="text/css" />

        <style>
            .btn-light {
                border-color: transparent;
            }
        </style>
        <!--  END CUSTOM STYLE FILE  -->
    </head>

    <body class="form">
        <div id="loginApp">

            <div class="form-container outer">
                <div class="form-form">
                    <div class="form-form-wrap">
                        <div class="form-container">
                            <div class="form-content">

                                <img src="assets/img/beleful.png" height="200" width="200" class="img-fluid"
                                    alt="Beleful">
                                <p class="">Log in to your account to continue.</p>

                                <form class="text-left" @submit="loginUser" method="post">
                                    <div class="form pb-3">

                                        <div v-if="errors.length">
                                            <div v-for="error in errors"
                                                class="alert alert-arrow-right alert-icon-right alert-light-danger mb-4"
                                                role="alert">
                                                <button type="button" class="close" data-dismiss="alert"
                                                    aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg"
                                                        data-dismiss="alert" width="24" height="24" viewBox="0 0 24 24"
                                                        fill="none" stroke="currentColor" stroke-width="2"
                                                        stroke-linecap="round" stroke-linejoin="round"
                                                        class="feather feather-x close">
                                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                                    </svg></button>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="feather feather-alert-circle">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                                    <line x1="12" y1="16" x2="12" y2="16"></line>
                                                </svg>
                                                <strong>Warning!</strong> {{error}}
                                            </div>
                                        </div>

                                        <div id="username-field" class="field-wrapper input">
                                            <label for="email">EMAIL</label>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="feather feather-user">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                            <input v-model="email" id="email" name="email" type="email"
                                                class="form-control" placeholder="e.g john@example.com" required>
                                            <div class="valid-feedback">
                                                Looks good!
                                            </div>
                                        </div>

                                        <div id="password-field" class="field-wrapper input mb-2">
                                            <div class="d-flex justify-content-between">
                                                <label for="password">PASSWORD</label>
                                                <a href="auth_pass_recovery_boxed.html" class="forgot-pass-link">Forgot
                                                    Password?</a>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="feather feather-lock">
                                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                            </svg>
                                            <input v-model="password" id="password" name="password" type="password"
                                                class="form-control" placeholder="Password" required>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round" id="toggle-password"
                                                class="feather feather-eye">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                        </div>
                                        <div class="d-sm-flex justify-content-between">
                                            <div class="field-wrapper">
                                                <button type="submit" class="btn btn-primary">
                                                    <div v-if="loading">
                                                        <div
                                                            class="spinner-border text-white mr-2 align-self-center loader-sm ">
                                                            Loading...</div>
                                                        Loading
                                                    </div>
                                                    <div v-else>Log In</div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
        <script src="assets/js/vue.js"></script>
        <script>
            var app = new Vue({
                el: '#loginApp',
                data: {
                    email: null,
                    password: null,
                    errors: [],
                    loading: false,
                },
                methods: {
                    loginUser: function (e) {
                        e.preventDefault();

                        this.errors = [];

                        if (!this.validEmail(this.email)) {
                            this.errors.push('Valid email required.');
                        }

                        if (this.errors.length > 0) {
                            return;
                        }

                        this.loading = true;

                        axios.post(generateURL(LOGIN_URL), {
                            email: this.email,
                            password: this.password,
                        }).then((response) => {
                            responseData = response.data;
                            console.log(responseData.data);
                            if (responseData.data.user.is_vendor || responseData.data.user.is_superuser) {
                                localStorage.setItem('token', responseData.data.access);
                                localStorage.setItem('user', JSON.stringify(responseData.data.user));
                                if (responseData.data.user.is_vendor) {
                                    localStorage.setItem('vendor', JSON.stringify(responseData.data.vendor));
                                }else{
                                    localStorage.removeItem('vendor');
                                }
                                window.location.href = 'index.html';
                                console.log('*****************');
                                console.log(localStorage.getItem('token'));
                                console.log(JSON.parse(localStorage.getItem('user')));
                            } else {
                                this.errors.push('You do not have access to login');
                            }
                            this.loading = false;
                        }).catch((error) => {

                            errorData = error.response.data;
                            console.log(errorData);
                            this.errors.push(errorData.errors);
                            this.loading = false;
                        });
                    },
                    validEmail: function (email) {
                        var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                        return re.test(email);
                    }
                }
            });
        </script>
        <script src="assets/js/libs/jquery-3.1.1.min.js"></script>
        <script src="bootstrap/js/popper.min.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>

        <!-- END GLOBAL MANDATORY SCRIPTS -->
        <script src="https://unpkg.com/feather-icons"></script>
        <script>
            feather.replace();
        </script>
        <script src="assets/js/authentication/form-2.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

        <script src="assets/custom/js/constants.js"></script>
    </body>

</html>